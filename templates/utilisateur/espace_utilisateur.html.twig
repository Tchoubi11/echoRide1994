{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-5">
    <h2>Bonjour {{ utilisateur.pseudo }}</h2>

    <h3>Je suis :</h3>
    {{ form_start(formType) }}
        {{ form_row(formType.type_utilisateur) }}
        <button class="btn btn-success">Mettre Ã  jour</button>
    {{ form_end(formType) }}

    {% if utilisateur.typeUtilisateur %}
        <p class="mt-2">Actuellement sÃ©lectionnÃ© : <strong>{{ utilisateur.typeUtilisateur|capitalize }}</strong></p>
    {% endif %}

    {% if utilisateur.typeUtilisateur in ['chauffeur', 'les_deux'] and utilisateur.voitures is empty %}
        <div class="alert alert-warning">
            ğŸš— Vous Ãªtes chauffeur, mais vous n'avez enregistrÃ© aucun vÃ©hicule.
            <br>
            Veuillez ajouter un vÃ©hicule pour proposer des trajets.
            <br><br>
            <a href="#ajouter-vehicule" class="btn btn-sm btn-primary mt-2">Ajouter un vÃ©hicule</a>
        </div>
    {% endif %}

    {% if utilisateur.typeUtilisateur in ['chauffeur', 'les_deux'] %}
        <h3 id="ajouter-vehicule">Mes vÃ©hicules</h3>
        {% if form is not null %}
            {{ form_start(form) }}
                <div class="row">
                    <div class="col-md-6">
                        {{ form_row(form.immatriculation) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.datePremiereImmatriculation) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        {{ form_row(form.modele) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.couleur) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.marque) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        {{ form_row(form.placesDisponibles) }}
                    </div>
                </div>

                <h4 class="mt-4">PrÃ©fÃ©rences :</h4>
                <div class="row">
                    <div class="col-md-4">
                        {{ form_row(form.preference.fumeur) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.preference.animaux) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.preference.autres) }}
                    </div>
                </div>

                <button type="submit" class="btn btn-primary mt-3">Enregistrer</button>
            {{ form_end(form) }}
        {% endif %}
    {% endif %}

    {% if utilisateur.typeUtilisateur == 'passager' %}
        <p class="alert alert-info mt-3">
            ğŸ‘¤ En tant que passager, aucune information supplÃ©mentaire n'est requise.
        </p>
    {% endif %}

    {% if utilisateur.typeUtilisateur in ['passager', 'les_deux'] %}
        <h3 class="mt-4">ğŸ§¾ Mes rÃ©servations en tant que passager</h3>

        {% if reservations is not empty %}
            <ul class="list-group">
                {% for reservation in reservations %}
                    <li class="list-group-item">
                        <span class="badge bg-success">ğŸ›£ï¸ RÃ©servation</span>
                        <strong>{{ reservation.covoiturage.lieuDepart }}</strong> â†’ <strong>{{ reservation.covoiturage.lieuArrivee }}</strong><br>
                        ğŸ“… Date : {{ reservation.covoiturage.dateDepart|date('d/m/Y H:i') }}<br>
                        ğŸ’º Places rÃ©servÃ©es : {{ reservation.placesReservees }}<br>
                        ğŸ’° PayÃ© : {{ reservation.montantPaye }} crÃ©dits<br>
                        âœ… Statut : {{ reservation.statut }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted">Vous n'avez pas encore de rÃ©servations.</p>
        {% endif %}
    {% endif %}

    {% if utilisateur.typeUtilisateur in ['chauffeur', 'les_deux'] %}
        <h3 class="mt-4">ğŸš— Mes trajets proposÃ©s en tant que chauffeur</h3>

        {% if covoituragesProposes is not empty %}
            <ul class="list-group">
                {% for trajet in covoituragesProposes %}
                    <li class="list-group-item">
                        <span class="badge bg-primary">ğŸš— Trajet</span>
                        <strong>{{ trajet.lieuDepart }}</strong> â†’ <strong>{{ trajet.lieuArrivee }}</strong><br>
                        ğŸ“… Date : {{ trajet.dateDepart|date('d/m/Y H:i') }}<br>
                        ğŸ’º Places : {{ trajet.nbPlace }} | ğŸ’° {{ trajet.prixPersonne }} crÃ©dits
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted">Vous n'avez proposÃ© aucun trajet.</p>
        {% endif %}
    {% endif %}

    {% if formCovoiturage is defined and formCovoiturage is not null %}
    <h3 class="mt-5">â• Proposer un trajet</h3>
    {{ form_start(formCovoiturage) }}
        {{ form_row(formCovoiturage.lieuDepart) }}
        {{ form_row(formCovoiturage.lieuArrivee) }}
        {{ form_row(formCovoiturage.dateDepart) }}
        {{ form_row(formCovoiturage.dateArrivee) }}
        {{ form_row(formCovoiturage.prixPersonne) }}
        {{ form_row(formCovoiturage.nbPlace) }}

        {{ form_row(formCovoiturage.voiture) }}
        <button class="btn btn-success mt-3">Proposer</button>
    {{ form_end(formCovoiturage) }}
{% endif %}


    <a href="{{ path('user_profile') }}" class="btn btn-secondary mt-4">
        ğŸ‘¤ Voir mon profil
    </a>
</div>
{% endblock %}
